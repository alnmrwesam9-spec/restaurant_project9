
IBLADISH โ Update Playbook
๐ฅ ุงูุฏููู ุงูุฑุณูู ูุชุญุฏูุซ ูุดุฑูุน ุงูุฅูุชุงุฌ ุนูู ุงูุณูุฑูุฑ
๐งญ ููุฏูุฉ

ูุฐุง ุงูุฏููู ูุดุฑุญ ููู ุชููู ุจุชุญุฏูุซ ูุดุฑูุน IBLADISH ุนูู ุณูุฑูุฑ ุงูุฅูุชุงุฌ ุจุทุฑููุฉ ุขููุฉ ูุณุฑูุนุฉุ
ุจุฏูู ุฃู ูุฎุงุทุฑ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูุจุฏูู ุงูุชุฃุซูุฑ ุนูู ูููุงุช ุงูููุฏูุง ูุงูุตูุฑุ ูุจูุธุงู ุงุญุชุฑุงูู ูุดุงุจู ูุทุฑููุฉ ุชุดุบูู Laravel Forge / Capistrano / Dokku.

ุงููุดุฑูุน ุงูุขู ูุนูู ุจุฃุณููุจ:

โ stable data volumes
โ shared env/media/static
โ versioned releases
โ clean rollback strategy
๐ฉ ุงูุฌุฒุก ุงูุฃูู โ ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

ูุจู ุฃู ุชุญุฏูุซ ูุฌุจ ุงูุชุฃูุฏ ูู:

ุงุชุตุงู SSH ุจุงูุณูุฑูุฑ:

ssh ubuntu@SERVER_IP


ุฃูู ุฏุงุฎู ูุฌูุฏ:

/home/ubuntu


ุงููููููุงุช ุงูุฃุณุงุณูุฉ ููุฌูุฏุฉ:

docker volume ls


ูุฌุจ ุฑุคูุฉ:

ibladish_v3_media

ibladish_v3_staticfiles

ibladish_v3_frontend_dist

restaurant_project_new_pg_data

๐ฆ ุงูุฌุฒุก ุงูุซุงูู โ ุชุฌููุฒ ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ

ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ (ูุญูููุง)ุ ูู ุจุนูู Build ูููุณุฎุฉ ุงูุฌุฏูุฏุฉ:

๐ ูููู ุงููุณุฎุฉ:
backend/
frontend/
docker-compose.yml
docker-compose.override.disabled
deploy/
package.json
manage.py
...


ุซู ุงุฑูุน ุงููุณุฎุฉ ุฅูู ุงูุณูุฑูุฑ ุฏุงุฎู:

/home/ubuntu/ibladish_releases/v4/


ูู ุฅุตุฏุงุฑ ููุถุน ูู ูุฌูุฏ ุฌุฏูุฏ ุฏุงุฎู releases
v4 โ v5 โ v6 โฆ ูููุฐุง

ูุซุงู:

/home/ubuntu/ibladish_releases/v4

๐จ ุงูุฌุฒุก ุงูุซุงูุซ โ ุฅููุงู ุงููุดุฑูุน ุงููุฏูู (ุจุดูู ุขูู)

ุฏุงุฎู ุงูุณูุฑูุฑ:

cd ~/ibladish_v3
docker compose down


โ ูุดุฑูุนู ุณูุชููู ูุญุธููุง (ุนุฏุฉ ุซูุงูู).

๐ง ุงูุฌุฒุก ุงูุฑุงุจุน โ ุงุณุชุจุฏุงู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ุจุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ
ุงุญุฐู ุงููุฌูุฏ ุงููุฏูู:
rm -rf ~/ibladish_v3

ุงูุณุฎ ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ ุฅูู ููุงู ุงูุชุดุบูู:
cp -R ~/ibladish_releases/v4 ~/ibladish_v3


ุงูุขู ุฃุตุจุญ:

/home/ubuntu/ibladish_v3 โ ูุญุชูู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ

๐ฅ ุงูุฌุฒุก ุงูุฎุงูุณ โ ููู ูููุงุช ุงูุจูุฆุฉ (.env)

ููู ุงูุจูุฆุฉ ูุง ูุชุบูุฑ ุจูู ุงูุฅุตุฏุงุฑุงุชุ ูุฐูู ูุณุชุฎุฏู ุงููุณุฎุฉ ุงููุดุชุฑูุฉ:

cp ~/ibladish_shared/env/.env ~/ibladish_v3/.env

๐ช ุงูุฌุฒุก ุงูุณุงุฏุณ โ ุชุดุบูู ุงููุดุฑูุน ุจุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ

ุฏุงุฎู ุงููุฌูุฏ ุงูุฌุฏูุฏ:

cd ~/ibladish_v3
docker compose up -d


ุฑุงูุจ ุฃู ูู ุดูุก ูุนูู:

docker compose ps


ูุชุฃูุฏ ุฃู:

ibla_db = healthy

backend = started

nginx = started

frontend_builder = started

๐ซ ุงูุฌุฒุก ุงูุณุงุจุน โ ูุญุต ุงููุธุงู ุจุนุฏ ุงูุชุญุฏูุซ
1) ุชุฃูุฏ ูู ุณูุงูุฉ Django migrations
docker exec -it backend sh -c "python manage.py showmigrations"

2) ุชุฃูุฏ ุฃู ุงูููุฏูุง ุชุนูู:

ุงูุชุญ:

https://ibladish.com/media/avatars/

3) ุชุฃูุฏ ุฃู ุงููุงุฌูุฉ ุชุนูู:
https://ibladish.com/

๐ฉ ุงูุฌุฒุก ุงูุซุงูู โ ุงูุฑุฌูุน ุฅูู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู (Rollback)

ูู ุญุฏุซ ุฃู ุฎุทุฃุ ุนูููุฉ ุงูุชุฑุงุฌุน ุจุณูุทุฉ:

ุฃููู ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ:

cd ~/ibladish_v3
docker compose down


ุงูุณุญ ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ:

rm -rf ~/ibladish_v3


ุงุณุชุฑุฌุน ุงูุฅุตุฏุงุฑ ุงููุฏูู:

cp -R ~/ibladish_releases/v3 ~/ibladish_v3
cp ~/ibladish_shared/env/.env ~/ibladish_v3/.env


ุฃุนุฏ ุชุดุบููู:

cd ~/ibladish_v3
docker compose up -d


๐ฅ ูุง ุดูุก ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฃู ุงูููุฏูุง ูุฃู ูู ุดูุก ูู Volumes ูููุตูุฉ

๐ฆ ุงูุฌุฒุก ุงูุชุงุณุน โ ุชูุธูู ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ

ุจุนุฏ ูุชุฑุฉ ูุฏ ุชุฑุบุจ ุจุฅุฒุงูุฉ ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ:

rm -rf ~/ibladish_releases/v1
rm -rf ~/ibladish_releases/v2
rm -rf ~/ibladish_releases/v3


โ ูุง ุชุญุฐู ุงููููููุงุช ุฃุจุฏูุง.
ููุท ูุฌูุฏุงุช ุงูุฅุตุฏุงุฑุงุช.

๐จ ุงูุฌุฒุก ุงูุนุงุดุฑ โ ูุตุงุฆุญ ุฐูุจูุฉ ูููุณุชูุจู
โ ูุง ุชุนุฏูู ุงููููููุงุช
โ ูุง ุชุบููุฑ ุงุณู ููููู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ ูู ุฅุตุฏุงุฑ ุฌุฏูุฏ ููุฑูุน ุฏุงุฎู releases
โ ููู .env ุฏุงุฆููุง ูุฃุชู ูู shared
โ nginx.conf ู SSL ูููุงุช ุซุงุจุชุฉ ุฏุงุฆููุง
โ ุงุณุชุฎุฏู ุฏุงุฆููุง docker compose down && up -d